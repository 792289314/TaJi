<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>她记——主页面</title>
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" type="text/css" href="fonts/loginFonts/iconfont.css">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style lang="scss" scoped>
        ::-webkit-scrollbar {
            display: none;
            width: 0;
        }

        a {
            text-decoration: none;
        }

        html, body, #app, .el-container {
            /*设置内部填充为0，几个布局元素之间没有间距*/
            padding: 0;
            /*外部间距也是如此设置*/
            margin: 0;
            /*统一设置高度为100%*/
            height: 100%;
        }

        .el-header {
            background-color: #B3C0D1;
            color: #333;
            /*max-height: 80px;*/
        }

        .el-aside {
            background-color: transparent;
            text-align: center;
            background-image: url(./images/lightpaperfibers.png);
        }

        .el-main {
            background-color: transparent;
            color: #333;
            background-image: url(./images/lightpaperfibers.png);
            /*width: 500px;!important;*/
            /*margin: 0 auto;*/
        }

        /*去除input的轮廓线*/
        input {
            outline: none;
        }

        /*防止文本欲拖拽*/
        textarea {
            resize: none;
            /*outline: none; !*去除轮廓线*!*/
        }

        .icon-hengdengyu {
            font-size: 40px;
        }

        .personalBtn /*个人中心按钮*/
        {
            position: fixed;
            left: 2px;
            top: -2px;
            background-color: transparent;
        }

        .addDiaryBtn /*添加日记按钮*/
        {
            position: fixed;
            right: 10px;
            bottom: 10px;
            font-size: 40px;
        }

        .header {
            /*height:50px;*/
            width: 100%;
            /*height: 200px;*/
            min-height: 80px;
            background-color: #99cdaa;
        }
        .posBox
        {
            position : relative;
            width: 80%;
            margin: auto;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            /*border: 1px solid #99cdaa;*/
        }
        .addBox /*添加日记*/
        {
            width: 40%;
            margin-left: 100px;

        }
        .addBox span{
            display: inline-block;
            font-size: 15px;
            text-align: justify;
        }
        .controlBigBox
        {
            margin-left: 30px;
        }
        .rightAddBox
        {
            position: absolute;
            top: 0;
            /*left: 200px;*/
            right: 0;
            width: 45%;
            height: 100%;
            margin-left: 50px;
            margin-top: 170px;

            /*background-color: coral;*/
        }

        .classifyBtn {
            vertical-align: middle;
            margin-left: 50px;
            margin-top: 20px;
        }



        #move {
            width: 75%;
            margin: 0 auto;
        }

        :focus {

            outline: 0;
        }

        .move_div {
            height: 200px;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
            width: 48%;
            float: left;
            border-right-color: black;
            min-height: 100px;

        }

        .move_div2 {
            height: 180px;
            width: 48%;
            float: right;
            margin-left: 5px;
            min-height: 100px;
            color: rgba(128, 128, 128, 0.8);
            /*padding-top: 5px;*/
            padding-top: 20px;

        }

        .move_div1 {
            /*color: ;*/
            height: 200px;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
            width: 48%;
            float: right;
            border-right-color: black;
            min-height: 100px;

            /*div1.style.height = "100px";*/

            /*div1.style.boxShadow = '0 4px 8px 0 rgba(0,0,0,0.2)';*/
            /*div1.style.width = '50%';*/
            /*div1.style.float = 'right';*/
            /*div1.style.borderRightColor = 'black';
            div1.style.minHeight = "100px";*/
        }

        .move_div3 {
            height: 180px;
            width: 48%;
            float: left;
            text-align: right;
            margin-left: 5px;
            min-height: 100px;
            color: rgba(128, 128, 128, 0.8);
            padding-top: 20px;

            /*div3.style.height = "100px";
            div3.style.backgroundColor = '﻿﻿#fec374';
            div3.style.width = '45%';
            div3.style.float = 'left';
            div3.style.textAlign = 'right';
            div3.style.color = 'rgba(128,128,128,0.8)';*/
        }
        .el-input__inner
        {
            height: 30px;
            line-height: 30px;
        }

        #publishBtn
        {
            background-color: #99cdaa;
            width: 200px;
            height: 43px;
            margin-left: 80px;
            border-radius: 5px;
            border: none;
        }
    </style>
    <script src="http://unpkg.com/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
</head>
<body>
<div id="app">
    <!--    :direction="direction"控制显示方向 rtl / ltr / ttb / btt-->
    <!--    添加日记折叠框-->
    <el-drawer
            title="添加日记"
            :size="'600px'"
            :visible.sync="addDrawer"
            direction="btt">
        <div class="posBox">
            <div class="addBox">
                <div class="classifyBox">
                    <span>分<i class="controlBigBox"></i>类:</span>
                    <el-select v-model="kindValue" clearable placeholder="请选择分类">
                        <el-option
                                v-for="(item,index) in kindOptions"
                                :key="item.value"
                                :label="item.label"
                                :value="index">
                        </el-option>
                    </el-select>
                    <a href="classifyManagement.html"><i class="el-icon-circle-plus-outline"></i></a>
                </div>
                <span>谁可以看:</span>
                <el-select v-model="checkPeoValue" clearable placeholder="请选择可查看的人">
                    <el-option
                            v-for="item in checkPeoOptions"
                            :key="item.value"
                            :label="item.label"
                            :value="item.value">
                    </el-option>
                </el-select>

                <div>
                    <span>天<i class="controlBigBox"></i>气:</span>
                    <el-select v-model="weatherValue" clearable placeholder="请选择天气">
                        <el-option
                                v-for="item in weatherOptions"
                                :key="item.value"
                                :label="item.label"
                                :value="item.value">
                        </el-option>
                    </el-select>
                </div>

                <span>日<i class="controlBigBox"></i>期:</span>
                <el-date-picker
                        v-model="dataValue"
                        align="right"
                        type="date"
                        placeholder="选择日期">
                </el-date-picker>

                <div class="colorBox">
                    <span>颜<i class="controlBigBox"></i>色:</span>
                    <input type="color" id="selectedColor">
                </div>

                <div class="fontBox">
                    <span>字<i class="controlBigBox"></i>体:</span>
                    <input type="range" id="selectedFont">
                </div>

                <!--添加日记文本内容-->
                <el-input
                        class="addTextArea"
                        type="textarea"
                        placeholder="请输入日记内容"
                        maxlength="500"
                        :rows="10"
                        show-word-limit
                        v-model="textarea1">
                </el-input>

            </div>
            <div class="rightAddBox">
                <el-upload
                        class="upload-demo"
                        drag
                        action="https://jsonplaceholder.typicode.com/posts/"
                        multiple>
                    <i class="el-icon-upload"></i>
                    <div class="el-upload__text">将文件拖到此处，或<em>点击上传</em>
                        <div class="el-upload__tip" slot="tip">只能上传jpg/png文件，且不超过500kb</div>
                    </div>

                </el-upload>
                <button id="publishBtn" @click="Publish">发布</button>
            </div>
        </div>

    </el-drawer>

    <!--个人中心折叠框-->
    <el-drawer class="personalDrawer"
               :size="'300px'"
               :visible.sync="personalDrawer"
               direction="ltr">
        <div>
            <span>{{welcomeUser}}</span><!--欢迎用户-->
            <!--个人中心折叠框中的过客列表页面-->
            <a href="visitorList.html" target="_blank">过客列表</a>
            <!--个人中心折叠框中的个人中心页面-->
            <a href="person.html" target="_blank">个人中心</a>
            <!--个人中心折叠框中的管理分类-->
            <a href="classifyManagement.html" target="_blank">管理分类</a>

            <button @click="exit">退出登录</button>
        </div>
    </el-drawer>
    <!--饿了么布局容器框架 头中右布局-->
    <el-container>
        <!--头部   包括个人中心按钮  两个div 一个全部 一个分类之后的-->
        <el-header class="header" height="''">

            <div>
                <el-button class="personalBtn" @click="personalDrawer = true" type="text">
                    <i class="iconfont icon-hengdengyu"></i>
                </el-button>
            </div>

            <!-- 分类-->
            <div class="classifyBtn">
                <!--动态生成radio 这里还有点问题 单选一选会把单选按钮都选上 不互斥了-->
                <el-radio-group v-model="classifyValue" @change="ChooseDiary">
                            <!--全部-->
<!--                    <div class="allClassifyBtn">-->
<!--                        &lt;!&ndash;{"cnt":7,"color":"7DCC67","flag":false,"id":0,"name":"全部"}-->
<!--                        {"cnt":5,"color":"#3f3f3f3f","flag":false,"id":1,"name":"未命名"}&ndash;&gt;-->
<!--                    </div>-->
<!--                    <el-radio v-model="classifyValue" label="-1">{{}}({{allDiaryMsg}})</el-radio>-->
<!--                    <el-radio v-model="classifyValue" label="0">未分类({{nonDiaryMsg}})</el-radio>-->

                    <el-radio
                            :label="index"
                            v-for=" (item,index) in classifyList">
                        {{item.name}}({{item.cnt}})
                        <!--前者是分类的名字 后者是对应的数量-->
                    </el-radio>

                </el-radio-group>

            </div>

        </el-header>
        <!--中间显示日记内容部分-->
        <el-container>

            <el-main>
                <!-- 目前暂时通过按钮来实现动态增加div 后期会放入watch还是computer里面-->
                <div id="move">
                    <!--                    <el-timeline>-->
                    <!--                        <el-timeline-item-->
                    <!--                                v-for="(activity, index) in activities"-->
                    <!--                                :key="index"-->
                    <!--                                :icon="activity.icon"-->
                    <!--                                :type="activity.type"-->
                    <!--                                :color="activity.color"-->
                    <!--                                :size="activity.size"-->
                    <!--                                :timestamp="activity.timestamp">-->
                    <!--                            {{activity.content}}-->
                    <!--                        </el-timeline-item>-->
                    <!--                    </el-timeline>-->
                </div>
            </el-main>


            <!--右边那个添加日记+按钮 占浏览器右边50px宽-->
            <el-aside width="50px">
                <el-button class="addDiaryBtn" @click="addDrawer = true" type="text" icon="el-icon-circle-plus-outline">
                </el-button>
            </el-aside>
        </el-container>

    </el-container>
</div>
<script>
    var vm = new Vue({
        el: '#app',
        data() {
            return {

                // 该用户所有的分类，默认第一个为 未分类
                userClassify: [],

                //该用户的所有日记 按事件分类
                userDiary: [],

                //当前界面上浏览的列表
                diaryList: [],

                // -------这是一个分割线-------

                welcomeUser: '',//个人中心欢迎你获取用户名
                personalDrawer: false,//个人中心折叠框
                addDrawer: false,//添加日记折叠框
                textarea1: '',//添加日记加的日记内容
                // allRadio:'-1',//绑定第一次选中全部按钮
                allDiaryMsg: '1',//全部日记数量
                nonDiaryMsg: '1',//未分类日记数量
                /*classifyList: [
                    {
                        value: '12',
                        classifyName: '旅行',
                    },
                    {
                        value: '13',
                        classifyName: '心情',
                    },
                    {
                        value: '14',//此项分类的数量
                        classifyName: '计划',
                    },
                ],
                classifyValue: '',*/
                /*
                    {"color":"#3f3f3f3f","flag":false,"id":1,"name":"未命名",cnt:9}
                    {"color":"#4a4a4a4a","flag":false,"id":2,"name":"学习",cnt:10}
                */
                classifyList: [
                    {//头部 显示右哪些分类的单选按钮
                        id: '2',
                        label: 2,
                        value: '12',
                        classifyName: '旅行',
                    },
                    {
                        id: '3',
                        label: 3,
                        value: '13',
                        classifyName: '心情',
                    },
                    {
                        id: '4',
                        label: 4,
                        value: '14',//此项分类的数量
                        classifyName: '计划',
                    }],
                classifyValue: 0,//-1代表选中全部按钮

                kindOptions: [
                    /*{
                        数组id
                        分类id
                        分类名
                        分类状态：公开/私密
                        分类显示的颜色
                    },*/
                    {
                        //添加日记中 分类的下拉列表框 需要给这样的数组
                        value: '选项1',// 值改成 用户分类的id
                        label: '旅游',
                        state: 0,
                        kindColor: '#ffff',
                    },
                    {
                        value: '选项2',
                        label: '心情',
                        state: 0,
                        kindColor: '#ffff',
                    },
                    {
                        value: '选项3',
                        label: '计划',
                        state: 0,
                        kindColor: '#ffff',
                    },
                    {
                        value: '选项4',
                        label: '与男友的事',
                        state: 0,
                        kindColor: '#ffff',
                    },
                    {
                        value: '选项5',
                        label: '。。。',
                        state: 0,
                        kindColor: '#ffff',
                    }],
                kindValue: '',//添加日记选中的分类的value
                kindState: '',

                weatherOptions: [{////添加日记中 天气的下拉列表框 需要给这样的数组
                    value: 0,
                    label: '晴天'
                }, {
                    value: 1,
                    label: '多云'
                }, {
                    value: 2,
                    label: '下雨'
                },],
                weatherValue: '',
                dataValue: '',

                checkPeoOptions: [
                    {//添加日记中 查看权限的下拉列表框 需要给这样的数组
                        value: 0,
                        label: '所有人可见'
                    },
                    {
                        value: 1,
                        label: '仅自己可见'
                    }],
                checkPeoValue: '',


                brandFold: true,
            }
        },

        created() {
            this.welcomeUser = sessionStorage.getItem("name");
            // 刚开始 从后台获取该用户的所有日记信息
            // 先拿所有分类信息 然后根据分类信息 拿到每个分类下的日记
            this.getClassify();
            this.getUserDiary();
            //this.addElement();


        },
        methods: {
            ChooseDiary: function (val) {
                this.getDiaryList(val);
                var div = document.getElementById("move");
                div.innerHTML = "";
                this.addElement();
            },


            // 获得星期中文
            getWeekToString: function (x) {
                if (x === 1) return "星期一";
                if (x === 2) return "星期二";
                if (x === 3) return "星期三";
                if (x === 4) return "星期四";
                if (x === 5) return "星期五";
                if (x === 6) return "星期六";
                return "星期日";
            },
            // 获得天气中文
            // ps：后悔 为啥不数据库里写好
            getWeatherToString(x) {
                if (x == 0) return "晴";
                if (x == 1) return "雨天";
                if (x == 2) return "多云";
            },


            //版面中间 动态生成div 从后端拿到日记内容 并一左一右显示
            addElement: function () {
                /*
                 后端传来的所有日记数据保存在 diaryList （数组）中， 这个变量我这边建了 但是你那边没有
                 {
                    "classifyColor":"#3f3f3f3f", // 分类颜色
                    "classifyFlag":false, // 该分类是否公开 0-公开 1-私密
                    "classifyId":1, // 分类的id
                    "classifyName":"未命名", // 分类的名字
                    "diaryFlag":false, // 当前日记是否公开 0-公开 1-私密
                    "diaryId":1," // 日记编号
                    "diaryText":"这是一个未公开的日记", // 日记内容
                    "diaryTime":{
                        "date":13,"day":0,"hours":10,"minutes":45,
                        "month":11,"nanos":0,"seconds":45,
                        "time":1607827545000,"timezoneOffset":-480,"year":120},
                        // 一个类型为TimeStamp的时间变量 这个还需要转处理一下 再等等
                    "diaryWeather":1 // 当前天气 0-晴天 1-多云 2-雨天
                   }
*/

                for (let i = 0; i < this.diaryList.length; i++) {
                    /*
                                 2020年12月12日 星期x
                                 20:45:45 晴（
                    */
                    const t = new Date(this.diaryList[i].diaryTime.time);
                    var str1 = t.getFullYear() + " 年 " + (t.getUTCMonth() + 1) + " 月 " +
                        t.getUTCDate() + " 日        " +
                        this.getWeekToString(t.getDay());
                    var str2 = t.getHours() + " : " +
                        t.getMinutes() + " : " + t.getSeconds() + "   " +
                        this.getWeatherToString(this.diaryList[i].diaryWeather);

                    if (i % 2 === 0)//偶数 显示在左边
                    {
                        let div = document.createElement('div');
                        // div.style.backgroundColor = 'red';
                        div.className = "move_div";
                        // 放日记主体text
                        //div.innerHTML = '{{左边}}';
                        div.innerHTML = this.diaryList[i].diaryText;
                        div.id = 'Elem' + i;
                        //var div_h = div.offsetHeight;
                        //alert(div_h);
                        document.getElementById('move').appendChild(div);

                        let div2 = document.createElement('div');
                        div2.className = "move_div2";
                        div2.innerHTML = str1 + '<br>' + str2;
                        div2.id = 'Ele' + i;
                        document.getElementById('move').appendChild(div2);

                    } else {
                        let div1 = document.createElement('div');
                        div1.className = "move_div1";


                        //div1.innerHTML = '{{右边}}';
                        div1.innerHTML = this.diaryList[i].diaryText;
                        div1.id = 'Elem' + i;

                        document.getElementById('move').appendChild(div1);


                        let div3 = document.createElement('div');
                        div3.className = "move_div3";
                        div3.innerHTML = str1 + '<br>' + str2;
                        div3.id = 'Ele' + i;
                        document.getElementById('move').appendChild(div3);
                    }
                }
            },


            // 提取 该用户 所有分类 并 统计 每一个分类 所拥有的日记数量
            // 提取 该用户 所有的 相关日记 按 创建日期排列
            // 点击 分类 显示 该分类下的日记 按创建事件排列
            getClassify: function () {
                var self = this;
                axios({
                    url: 'getClassify.do',
                    methods: 'post',
                }).then(function (response) {
                    if (response.data == "error") {
                        // session 中没有用户id
                        // 此时应该返回登陆界面重新登陆

                    } else {
                        // self.userClassify = response.data;
                        self.classifyList = response.data;

                    }
                }).catch(function (error) {
                    self.$message("请求过程中发生错误：" + error);
                })
            },

            // 获得用户的所有日记
            getUserDiary: function () {
                const self = this;
                axios({
                    url: 'getUserDiary.do',
                    methods: 'post'
                }).then(function (response) {
                    if (response.data == "error") {
                        // session 中没有用户id
                        // 此时应该返回登陆界面重新登陆
                    } else {
                        self.diaryList = self.userDiary = response.data;
                        self.addElement();// 得到日记记录后 更新ui
                    }

                }).catch(function (error) {
                    self.$message("提交过程中发生错误： error");

                })
            },


            // 从usrDiary中筛选出相关的列表 呈现在界面上
            getDiaryList: function (classifyId) {
                this.diaryList = [];
                //alert(classifyId);
                if (classifyId != 0) { // 用户特色分类
                    for (var i = 0; i < this.userDiary.length; i++) {
                        if (this.userDiary[i].classifyId == classifyId) {
                            // this.diaryList.add(this.userDiary[i]);
                            this.diaryList.push(this.userDiary[i]);
                        }
                    }
                } else {// 全部
                    this.diaryList = this.userDiary;
                }
            },

            // 还没写完
            // 右下角添加日记的发布按钮
            Publish: function () {
                let self = this;
                //alert(self.kindValue);
                let selectedColor = document.getElementById('selectedColor').value;
                let selectedFont = document.getElementById('selectedFont').value;
                // self.weatherValue
                const time = new Date().getTime(); // 获取当前时间
                //alert(time);
                // self.checkPeoValue
                //alert(self.textarea1)

                axios({
                    url: 'addDiary.do',
                    methods: 'post',
                    data: {
                        'classifyId': self.kindOptions[self.kindValue].value,
                        //'userId': '',在 java后台session里
                        'diaryFlag': self.checkPeoValue | self.kindOptions[self.kindValue].state,// 分类flag | 谁可以看flag
                        'diaryText': self.textarea1,
                        'diaryTime': time,
                        'diaryWeather': self.weatherValue
                    }
                }).then(function (response) {
                    if (response == "error") {
                        self.$message("添加日记操作失败");
                    } else {
                        self.$message("成功添加日记");
                        // 刷新界面 重新进入该网页

                    }
                }).catch(function (error) {
                    self.$message("请求过程中发生错误：" + error);
                })
            },

            exit: function () {
                axios({
                    url: '',
                    methods: 'post'
                }).then(function (response) {

                }).catch(function (error) {

                })
            },


        },
    })
</script>
</body>

</html>

